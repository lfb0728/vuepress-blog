(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{360:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"git-bug分支"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#git-bug分支"}},[t._v("#")]),t._v(" Git Bug分支")]),t._v(" "),a("p",[t._v("软件开发中，bug就像家常便饭一样。有了bug就需要修复，在Git中，由于分支是如此的强大，所以，每个bug都可以通过一个新的临时分支来修复，修复后，合并分支，然后将临时分支删除。")]),t._v(" "),a("p",[t._v("当你接到一个修复一个代号101的bug的任务时，很自然地，你想创建一个分支"),a("code",[t._v("issue-101")]),t._v("来修复它，但是，等等，咱先模拟一下有正在开发的dev分支，在"),a("code",[t._v("readme.txt")]),t._v("中添加一些内容:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Git is a distributed version control system.\nGit is free software distributed under the GPL.\nCreating a new branch is quick.\nCreating a new branch is quick AND simple.\n")])])]),a("p",[t._v("查看一下状态：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" status\nOn branch dev\nChanges not staged "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" commit:\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("use "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git add/rm <file>..."')]),t._v(" to update what will be committed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("use "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git restore <file>..."')]),t._v(" to discard changes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" working directory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        modified:   readme.txt\n        deleted:    remove.txt.txt\n\nno changes added to commit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("use "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git add"')]),t._v(" and/or "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git commit -a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("p",[t._v("并不是你不想提交，而是工作只进行到一半，还没法提交，预计完成还需1天时间。但是，必须在两个小时内修复该bug，怎么办？")]),t._v(" "),a("p",[t._v("幸好，Git还提供了一个"),a("code",[t._v("stash")]),t._v("功能，可以把当前工作现场“储藏”起来，等以后恢复现场后继续工作：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" stash\nSaved working directory and index state WIP on dev: 4afe796 第五个版本\n")])])]),a("p",[t._v("现在，用"),a("code",[t._v("git status")]),t._v("查看工作区，就是干净的（除非有没有被Git管理的文件），因此可以放心地创建分支来修复bug。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" status\nOn branch dev\nnothing to commit, working tree clean\n")])])]),a("p",[t._v("首先确定要在哪个分支上修复bug，假定需要在"),a("code",[t._v("master")]),t._v("分支上修复，就从"),a("code",[t._v("master")]),t._v("创建临时分支：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" switch master\nSwitched to branch "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'master'")]),t._v("\nYour branch is ahead of "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'origin/master'")]),t._v(" by "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" commits.\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("use "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git push"')]),t._v(" to publish your "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" commits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" checkout -b issue-101\nSwitched to a new branch "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'issue-101'")]),t._v("\n")])])]),a("p",[t._v('现在修复bug，需要把"11111".”改为删除，然后提交：')]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" readme.txt\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fix bug 101"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("issue-101 7207be8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" fix bug "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" changed, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" insertion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" deletion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("修复完成后，切换到"),a("code",[t._v("master")]),t._v("分支，并完成合并，最后删除"),a("code",[t._v("issue-101")]),t._v("分支：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" switch master\nSwitched to branch "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'master'")]),t._v("\nYour branch is ahead of "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'origin/master'")]),t._v(" by "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" commits.\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("use "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git push"')]),t._v(" to publish your "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" commits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" merge --no-ff -m "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"merge bug fix 101"')]),t._v(" issue-101  // 合并分支\nMerge made by the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'recursive'")]),t._v(" strategy.\n readme.txt "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" +-\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" changed, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" insertion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" deletion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("太棒了，原计划两个小时的bug修复只花了5分钟！现在，是时候接着回到"),a("code",[t._v("dev")]),t._v("分支干活了！")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" switch dev\nSwitched to branch "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dev'")]),t._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" status\nOn branch dev\nnothing to commit, working tree clean\n")])])]),a("p",[t._v("工作区是干净的，刚才的工作现场存到哪去了？用"),a("code",[t._v("git stash list")]),t._v("命令看看：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" stash list\nstash@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(": WIP on dev: 4afe796 第五个版本\n")])])]),a("p",[t._v("工作现场还在，Git把stash内容存在某个地方了，但是需要恢复一下，有两个办法：")]),t._v(" "),a("p",[t._v("一是用"),a("code",[t._v("git stash apply")]),t._v("恢复，但是恢复后，stash内容并不删除，你需要用"),a("code",[t._v("git stash drop")]),t._v("来删除；")]),t._v(" "),a("p",[t._v("另一种方式是用"),a("code",[t._v("git stash pop")]),t._v("，恢复的同时把stash内容也删了：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" stash pop // 弹出储藏信息，并删除stash内容\nRemoving remove.txt.txt\nOn branch dev\nChanges not staged "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" commit:\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("use "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git add/rm <file>..."')]),t._v(" to update what will be committed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("use "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git restore <file>..."')]),t._v(" to discard changes "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" working directory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        modified:   readme.txt\n        deleted:    remove.txt.txt\n\nno changes added to commit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("use "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git add"')]),t._v(" and/or "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git commit -a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nDropped refs/stash@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cb0aac61def8c9b7b697b9336474f90f26eb81da"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("再用"),a("code",[t._v("git stash list")]),t._v("查看，就看不到任何stash内容了：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" stash list\n")])])]),a("p",[t._v("你可以多次stash，恢复的时候，先用"),a("code",[t._v("git stash list")]),t._v("查看，然后恢复指定的stash，用命令：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" stash apply stash@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在master分支上修复了bug后，我们要想一想，dev分支是早期从master分支分出来的，所以，这个bug其实在当前dev分支上也存在。")]),t._v(" "),a("p",[t._v("那怎么在dev分支上修复同样的bug？重复操作一次，提交不就行了？")]),t._v(" "),a("p",[t._v("有木有更简单的方法？")]),t._v(" "),a("p",[t._v("有！")]),t._v(" "),a("p",[t._v("同样的bug，要在dev上修复，我们只需要把"),a("code",[t._v("7207be8 fix bug 101")]),t._v("这个提交所做的修改“复制”到dev分支。注意：我们只想复制"),a("code",[t._v("7207be8 fix bug 101")]),t._v("这个提交所做的修改，并不是把整个master分支merge过来。")]),t._v(" "),a("p",[t._v("为了方便操作，Git专门提供了一个"),a("code",[t._v("cherry-pick")]),t._v("命令，让我们能复制一个特定的提交到当前分支：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" branch\n* dev\n  master\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" cherry-pick 4c805e2\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("master 1d4b803"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" fix bug "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" changed, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" insertion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" deletion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("Git自动给dev分支做了一次提交，注意这次提交的commit是"),a("code",[t._v("1d4b803")]),t._v("，它并不同于master的"),a("code",[t._v("4c805e2")]),t._v("，因为这两个commit只是改动相同，但确实是两个不同的commit。用"),a("code",[t._v("git cherry-pick")]),t._v("，我们就不需要在dev分支上手动再把修bug的过程重复一遍。")]),t._v(" "),a("p",[t._v("有些聪明的童鞋会想了，既然可以在master分支上修复bug后，在dev分支上可以“重放”这个修复过程，那么直接在dev分支上修复bug，然后在master分支上“重放”行不行？当然可以，不过你仍然需要"),a("code",[t._v("git stash")]),t._v("命令保存现场，才能从dev分支切换到master分支。")]),t._v(" "),a("p",[t._v("总结一下：")]),t._v(" "),a("p",[t._v("修复bug时，我们会通过创建新的bug分支进行修复，然后合并，最后删除；")]),t._v(" "),a("p",[t._v("当手头工作没有完成时，先把工作现场"),a("code",[t._v("git stash")]),t._v("一下，然后去修复bug，修复后，再"),a("code",[t._v("git stash pop")]),t._v("，回到工作现场；")]),t._v(" "),a("p",[t._v("在master分支上修复的bug，想要合并到当前dev分支，可以用"),a("code",[t._v("git cherry-pick")]),t._v("命令，把bug提交的修改“复制”到当前分支，避免重复劳动。")])])}),[],!1,null,null,null);s.default=n.exports}}]);